{%- from "cinder/map.jinja" import controller with context %}
{%- set region = controller.identity.region %}
check:
  local_cinder_api_proc:
    command: "PATH=$PATH:/usr/lib64/nagios/plugins:/usr/lib/nagios/plugins check_procs -C cinder-api -u cinder -c 1:1024"
    interval: 60
    occurrences: 1
    subscribers:
    - local-cinder-controller
  local_cinder_scheduler_proc:
    command: "PATH=$PATH:/usr/lib64/nagios/plugins:/usr/lib/nagios/plugins check_procs -C cinder-schedule -u cinder -c 1:5"
    interval: 60
    occurrences: 1
    subscribers:
    - local-cinder-controller
  local_cinder_volume_proc:
    command: "PATH=$PATH:/usr/lib64/nagios/plugins:/usr/lib/nagios/plugins check_procs -C cinder-volume -u cinder -c 1:5"
    interval: 60
    occurrences: 1
    subscribers:
    - local-cinder-volume
  remote_openstack_cinder_api:
    command: "PATH=$PATH:/etc/sensu/plugins check_cinder_api.sh -u :::openstack.user::: -p :::openstack.password::: -t :::openstack.tenant::: -h 'http://:::openstack.host:::' -w 10"
    interval: 60
    occurrences: 1
    subscribers:
    - remote-network
  remote_openstack_cinder_volume:
    command: "PATH=$PATH:/usr/local/bin oschecks-check_cinder_volume --auth_url='http://:::openstack.host:::::::openstack.port:::/v2.0' --username :::openstack.user::: --password :::openstack.password::: --tenant :::openstack.tenant::: --region_name {{ region }}"
    interval: 300
    occurrences: 1
    subscribers:
    - remote-network
  remote_cinder_services:
    command: "PATH=$PATH:/etc/sensu/plugins check_cinder_services.sh -u :::openstack.user::: -p :::openstack.password::: -t :::openstack.tenant::: -h 'http://:::openstack.host:::::::openstack.port:::/v2.0'"
    interval: 60
    occurrences: 1
    subscribers:
    - remote-network